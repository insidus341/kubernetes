- hosts: master
  become: yes
  become_user: james

  tasks:
    - name: Ensure destination directory exists
      command: mkdir -p ~/manifests/nginx-hello-kubernetes

    - name: Copy required manifests
      ansible.builtin.copy:
        src: ~/kubernetes/manifests/nginx-hello-kubernetes
        dest: ~/manifests/
      
    - name: Add first Deployment to Kubernetes Cluster
      command: kubectl apply -f ~/manifests/nginx-hello-kubernetes/hello-kubernetes-first.yml  

    - name: Add second Deployment to Kubernetes Cluster
      command: kubectl apply -f ~/manifests/nginx-hello-kubernetes/hello-kubernetes-second.yml  

    - name: Add Ingress service
      command: kubectl apply -f ~/manifests/nginx-hello-kubernetes/hello-kubernetes-ingress.yml